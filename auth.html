<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication is Fun</title>
	
	<link rel="stylesheet" href="css/auth.css">

	<script type="module" src="../nailbar/js/auth.js" defer>
		
		import{initializeApp} from "firebase/app";
		import{getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut} from "firebase/auth";
		import{ getDatabase, set, get, update, remove, ref, child}from "firebase/database";
		
		const firebaseConfig = {
			apiKey: "AIzaSyAi7vWrdz6NCnFlnuY3KT77lB3Xw8Lg1Hc",
			authDomain: "nailbar-bc5e8.firebaseapp.com",
			projectId: "nailbar-bc5e8",
			storageBucket: "nailbar-bc5e8.appspot.com",
			messagingSenderId: "672707669091",
			appId: "1:672707669091:web:c770672694748a01f75c56"
		}; //"https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";


		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
		const db = getDatabase();

		const checkAuthState = async() => {
			onAuthStateChanged(auth, user => {
			if(user) {
				$("userfirstName").style.display= "none" ;
				$("userlastName").style.display= "none" ;
				$("userPhoneNumber").style.display= "none" ;
				alert("you are already signed in");
				location.href("main.html");

			}

			else {
				$("userfirstName").style.display= "block" ;
				$("userlastName").style.display= "block" ;
				$("userPhoneNumber").style.display= "block" ;
			}
		})
		}

		checkAuthState();

		const userSignUp = async() => {

		let signUpEmail = $("#userEmail").val();
		let signUpPassword = $("#userPassword").val();
		createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		console.log(user);
		alert("Your account has been created!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		}

		const userSignIn = async() => {
		signInEmail = $("#userEmail").val();
		signInPassword = $("#userPassword").val();
		signInWithEmailAndPassword(auth, signInEmail, signInPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		InsertData();
		alert("You have signed in successfully!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		};

		$("#signUpButton").click(userSignUp);
		$("#signInButton").click(userSignIn);

	</script>

	<!--jquery-->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

</head>

<body>
    <div id="wrapper" class="wrapper">
		
		<div class="title">Login</div>
			<form id="authForm" class="login-details " action="#">
				<div class="input-box">
					<label class="emailInputLabel" for="userEmail">Email</label>
					<input id="userEmail" type="email" placeholder="e-Mail" required />
					<i class='bx bx-user'></i>
				</div>

				<div class="input-box">
					<label class="userPasswordLabel" for="userPassword">Password</label>
					<input id="userPassword" type="password" placeholder="password" required />
					<i class='bx bxs-lock-alt'></i>
				</div>

			
				<span class="signUpContent" id="signUpContent">	
					<div class="input-box">
						<label class="userfirstNameLabel" for="userfirstName">First Name</label>
						<input id="userfirstName" placeholder="First Name"/>
						<i class='bx bxs-lock-alt'></i>
					</div>

					<div class="input-box">
						<label class="userlastNameLabel" for="userlastName">Last Name</label>
						<input id="userlastName" placeholder="Last Name"/>
						<i class='bx bxs-lock-alt'></i>
					</div>

					<div class="input-box">
						<label class="userPhoneNumberLabel" for="userPhoneNumber">Phone Number</label>
						<input id="userPhoneNumber" placeholder="Phone Number"/>
						<i class='bx bxs-lock-alt'></i>
					</div>
				</span>

				<div class="signInButton">
					<button type="submit" id="signInButton">Login</button>
				</div>
				
				<div class="register-link">
					<p>don't have an account?<button type="submit" id="signUpButton"> Sign Up</button></p>
				</div>
			</form>
		</div>
</body>  
</html> 