<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication is Fun</title>
	
	<link rel="stylesheet" href="css/auth.css">

	<script type="module" src="../nailbar/js/auth.js" defer>

		import{getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut} from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
		import{ getDatabase, set, get, update, remove, ref, child}from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
		
		const firebaseConfig = {
		apiKey: "AIzaSyA4xMNCyjxbhux_hBDe-nO9pF4uDsiipaI",
		authDomain: "salon-be3a1.firebaseapp.com",
		projectId: "salon-be3a1",
		storageBucket: "salon-be3a1.appspot.com",
		messagingSenderId: "425524125484",
		appId: "1:425524125484:web:64dbba0782b46ec4d29689",
		measurementId: "G-FHGB2XZM6D"
		} //from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";


		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
		const db = getDatabase();


		const userSignUp = async() => {

		let signUpEmail = $("#userEmail").val();
		let signUpPassword = $("#userPassword").val();
		firebase.auth().createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		console.log(user);
		InsertData();
		alert("Your account has been created!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		}

		const userSignIn = async() => {
		signInEmail = $("#userEmail").val();
		signInPassword = $("#userPassword").val();
		signInWithEmailAndPassword(auth, signInEmail, signInPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		InsertData();
		alert("You have signed in successfully!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		}

		const userSignOut = async() => {
		await signOut(auth);
		}

		const checkAuthState = async() => {
			onAuthStateChanged(auth, user => {
			if(user) {
				location.href="../nailbar/main.html";
				$("#signOutButton").style.display="block";
				$("#business").style.display= "flex";

			}

			else {

				userfirstName.style.display= "block";
				userLastName.style.display= "block";
				userPhoneNumber.style.display= "block";
				$("#signOutButton").style.display="none";
				$("#business").style.display= "none";

			}
		})
	}

		checkAuthState();

		signUpButton.addEventListener('click', userSignUp);
		signInButton.addEventListener('click', userSignIn);
		signOutButton.addEventListener('click', userSignOut);

		function InsertData(){
		set(ref(db, "People/" + firebase.auth().currentUser.uid + "person/", {
		name: userfirstName.value,
		email: userEmail.value,
		phoneNumber: userPhoneNumber.value,
		})
		.then(()=>{
		alert("Data Added Successfully");
		})
		.catch((errpr)=>{
		alert(error);
		})
		)};
	</script>

</head>

<body>
    <div id="authForm" class="authForm">
		
		<div class="title">Login</div>
			<form id="authForm" class="login-details " action="#">
				<div class="input-box">
					<label class="emailInputLabel" for="userEmail">Email</label>
					<input id="userEmail" type="email" placeholder="e-Mail" required />
					<i class='bx bx-user'></i>
				</div>

				<div class="input-box">
					<label class="userPasswordLabel" for="userPassword">Password</label>
					<input id="userPassword" type="password" placeholder="password" required />
					<i class='bx bxs-lock-alt'></i>
				</div>

			
				<span class="signUpContent" id="signUpContent">	
					<div class="input-box">
						<label class="userfirstNameLabel" for="userfirstName">First Name</label>
						<input id="userfirstName" placeholder="First Name"/>
						<i class='bx bxs-lock-alt'></i>
					</div>

					<div class="input-box">
						<label class="userlastNameLabel" for="userlastName">Last Name</label>
						<input id="userlastName" placeholder="Last Name"/>
						<i class='bx bxs-lock-alt'></i>
					</div>

					<div class="input-box">
						<label class="userPhoneNumberLabel" for="userPhoneNumber">Phone Number</label>
						<input id="userPhoneNumber" placeholder="Phone Number"/>
						<i class='bx bxs-lock-alt'></i>
					</div>
				</span>

				<div class="signInButton">
					<button type="submit" id="signInButton">Login</button>
				</div>
				
				<div class="register-link">
					<p>don't have an account?<button type="submit" id="signUpButton"> Sign Up</button></p>
				</div>
			</form>
		</div>

</body>  
</html> 