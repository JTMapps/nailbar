<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication is Fun</title>
	
	<link rel="stylesheet" href="css/auth.css">

	<script type="module" src="../nailbar/js/auth.js" defer>
		const userSignUp = async() => {

		let signUpEmail = $("#userEmail").val();
		let signUpPassword = $("#userPassword").val();
		firebase.auth().createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		console.log(user);
		InsertData();
		alert("Your account has been created!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		}

		const userSignIn = async() => {
		signInEmail = $("#userEmail").val();
		signInPassword = $("#userPassword").val();
		firebase.auth().signInWithEmailAndPassword(auth, signInEmail, signInPassword)
		.then((userCredential) => {
		const user = userCredential.user;
		InsertData();
		alert("You have signed in successfully!");
		})
		.catch((error) => {
		const errorCode = error.code;
		const errorMessage = error.message;
		console.log(errorCode + errorMessage)
		})
		}

		const userSignOut = async() => {
		await signOut(auth);
		}

		const checkAuthState = async() => {
		onAuthStateChanged(auth, user => {
		if(user) {
			location.href="../nailbar/main.html";
			$("#signOutButton").style.display="block";
			$("#business").style.display= "flex";

		}

		else {

			userfirstName.style.display= "block";
			userLastName.style.display= "block";
			userPhoneNumber.style.display= "block";
			$("#signOutButton").style.display="none";
			$("#business").style.display= "none";

		}
		})
		}

		checkAuthState();

		signUpButton.addEventListener('click', userSignUp);
		signInButton.addEventListener('click', userSignIn);
		signOutButton.addEventListener('click', userSignOut);

		function InsertData(){
		set(ref(db, "People/" + firebase.auth().currentUser.uid + "person/", {
		name: userfirstName.value,
		email: userEmail.value,
		phoneNumber: userPhoneNumber.value,
		})
		.then(()=>{
		alert("Data Added Successfully");
		})
		.catch((errpr)=>{
		alert(error);
		})
		)};
	</script>

</head>
<body>
    <div id="authForm" class="authForm">
		
			<div class="title">Login</div>
			<form id="authForm" class="login-details " action="#">
					<div class="input-box">
						<label class="emailInputLabel" for="userEmail">Email</label>
						<input id="userEmail" type="email" placeholder="e-Mail" required />
						<i class='bx bx-user'></i>
					</div>

					<div class="input-box">
						<label class="userPasswordLabel" for="userPassword">Password</label>
						<input id="userPassword" type="password" placeholder="password" required />
						<i class='bx bxs-lock-alt'></i>
					</div>

				
				    <span class="signUpContent" id="signUpContent">	
						<div class="input-box">
							<label class="userfirstNameLabel" for="userfirstName">First Name</label>
							<input id="userfirstName" placeholder="First Name"/>
							<i class='bx bxs-lock-alt'></i>
						</div>

						<div class="input-box">
							<label class="userlastNameLabel" for="userlastName">Last Name</label>
							<input id="userlastName" placeholder="Last Name"/>
							<i class='bx bxs-lock-alt'></i>
						</div>

						<div class="input-box">
							<label class="userPhoneNumberLabel" for="userPhoneNumber">Phone Number</label>
							<input id="userPhoneNumber" placeholder="Phone Number"/>
							<i class='bx bxs-lock-alt'></i>
						</div>
					</span>
	
					<div class="signInButton">
						<button type="submit" id="signInButton">Login</button>
					</div>
					
					<div class="register-link">
						<p>don't have an account?<button type="submit" id="signUpButton"> Sign Up</button></p>
					</div>
			</form>
    	</div>

</body>  
</html>